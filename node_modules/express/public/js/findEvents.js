var ref = new Firebase("https://toitle.firebaseio.com/events");
   //$(function() {
  //   alert("get flags");
   //    ref.once("value", function(snapshot) {
  // The callback function will get called twice, once for "fred" and once for "barney"
  //      snapshot.forEach(function(childSnapshot) {
  //        event = childSnapshot;
  //        eventAdress = event.child('event_address');
          //alert(""+childSnapshot.key()+eventAdress.val());
  //        alert("huh? "+points.length);
  //        points.push(eventAdress.val());
  //      });
  //    });
  //    return;
  //   });


    var lat = 38.987103;
    var lon = -76.942542;
    if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition( function(location){
        lat = location.coords.latitude;
        lon = location.coords.longitude;
    });
    }else{
      lat = 38.987103;
      lon = -76.942542;
    }

    var myCenter=new google.maps.LatLng(lat,lon);
    function initialize()
    {
       var mapProp = {
        center:myCenter,
        zoom:15,
        mapTypeId:google.maps.MapTypeId.ROADMAP
        };
      var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);

      ref.once("value", function(snapshot) {
  // The callback function will get called twice, once for "fred" and once for "barney"
        snapshot.forEach(function(childSnapshot) {
          event = childSnapshot;
          eventAdress = event.child('event_address');
          eventName="" + event.child('event_name').val();
          eventDescription="" + event.child('event_description').val();
          eventAdress = "" + eventAdress.val();
          var infowindow = new google.maps.InfoWindow({
            content: ("Event Name "+eventName+" Event Description "+eventDescription)
          });
          var str = eventAdress.replace("(", "");
          var str = str.replace(")", "");
          var res = str.split(", ");
          lat=res[0];
          lon=res[1];
          var myCenter=new google.maps.LatLng(lat,lon);
          var marker=new google.maps.Marker({
          position:myCenter,
          map: map,
          });
           marker.addListener('click', function() {
            infowindow.open(map, marker);
          });
          marker.setMap(map);
        });
      });

    }
